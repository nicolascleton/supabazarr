version: "3.8"

services:
  supabazarr:
    image: ghcr.io/nicolascleton/supabazarr:latest
    container_name: supabazarr
    restart: unless-stopped
    ports:
      - 8383:8383
    environment:
      - TZ=Europe/Paris
      - PUID=1000
      - PGID=1000
      - SUPABASE_URL=${SUPABASE_URL:-}
      - SUPABASE_SERVICE_KEY=${SUPABASE_SERVICE_KEY:-}
      - DEVICE_UUID=${DEVICE_UUID:-}
      - HOSTNAME=${HOSTNAME:-jellypi}
      - MEDIA_STACK_PATH=/media-stack
      - BACKUP_HOUR=${BACKUP_HOUR:-03:00}
    volumes:
      # Monter le dossier media-stack en lecture seule
      - ./:/media-stack:ro
      # Persister l'UUID et la config
      - supabazarr_data:/etc/supabazarr
      # Logs
      - ./logs/supabazarr:/var/log/supabazarr
    deploy:
      resources:
        limits:
          memory: 128M
          cpus: '0.25'
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8383/api/status"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 30s

volumes:
  supabazarr_data:
